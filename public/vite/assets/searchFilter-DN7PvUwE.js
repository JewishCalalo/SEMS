let f,p=null;function E(){const l=document.getElementById("searchFilterContent"),n=document.getElementById("toggleText"),r=document.getElementById("toggleIcon");if(!l||!n||!r){console.error("Required elements not found");return}const e=l.style.display==="none"||l.style.display==="";l.style.display=e?"block":"none",n.textContent=e?"Hide":"Show",r.style.transform=e?"rotate(180deg)":"rotate(0deg)"}function m(l=1){f&&clearTimeout(f),f=setTimeout(()=>{const n=document.getElementById("searchInput"),r=document.getElementById("categorySelect"),e=document.getElementById("equipmentTypeSelect"),c=document.getElementById("availabilitySelect"),y=document.getElementById("equipmentContainer"),a=document.getElementById("searchLoadingIndicator");if(!y)return;a&&a.classList.remove("hidden");const d=new URLSearchParams({search:n?.value||"",category:r?.value||"",equipment_type:e?.value||"",availability:c?.value||"",page:l});fetch(`/welcome/search?${d}`).then(o=>o.json()).then(o=>{if(a&&a.classList.add("hidden"),o.success){y.innerHTML=o.html;const i=new URL(window.location);["search","category","equipment_type","availability"].forEach(t=>{const h=d.get(t);h?i.searchParams.set(t,h):i.searchParams.delete(t)}),l>1?i.searchParams.set("page",l):i.searchParams.delete("page"),window.history.pushState({},"",i);const u=d.get("search")||d.get("category")||d.get("equipment_type")||d.get("availability"),g=document.getElementById("searchResultsCounter");if(u&&g&&o.pagination){const t=document.getElementById("resultsCount");t&&(t.textContent=o.pagination.total),g.style.display="inline"}}else y.innerHTML='<div class="text-center py-12 text-gray-500">No results found</div>'}).catch(o=>{console.error("Search error:",o),a&&a.classList.add("hidden"),y.innerHTML='<div class="text-center py-12 text-red-500">Error loading results</div>'})},300)}function I(){["searchInput","categorySelect","equipmentTypeSelect","availabilitySelect"].forEach(e=>{const c=document.getElementById(e);c&&(c.value="")});const n=document.getElementById("equipmentTypeSelect");if(n){p||(p=Array.from(n.options).map(e=>e.cloneNode(!0))),n.innerHTML="",p.forEach(e=>n.appendChild(e.cloneNode(!0))),n.value="",n.disabled=!0;try{const e=document.getElementById("equipmentTypeHelp");e&&(e.classList.remove("hidden"),e.style.display="",e.style.opacity="1")}catch{}}const r=document.getElementById("searchResultsCounter");r&&(r.style.display="none"),m(1),setTimeout(()=>{const e=document.getElementById("equipmentTypeSelect"),c=document.getElementById("equipmentTypeHelp");e&&(e.disabled=!0),c&&(c.classList.remove("hidden"),c.style.display="",c.style.opacity="1")},0),window.history.pushState({},"",window.location.pathname)}document.addEventListener("DOMContentLoaded",function(){console.log("SearchFilter.js initialized");const l=document.querySelector('[data-action="toggle-filter"]');l?(l.addEventListener("click",E),console.log("Toggle button event listener added")):console.error("Toggle button not found");const n=new URLSearchParams(window.location.search);if(n.has("search")||n.has("category")||n.has("equipment_type")||n.has("availability")){const s=document.getElementById("searchFilterContent"),o=document.getElementById("toggleText"),i=document.getElementById("toggleIcon");s&&o&&i&&(s.style.display="block",o.textContent="Hide",i.style.transform="rotate(180deg)")}const e=document.getElementById("searchInput");e&&e.addEventListener("input",()=>m(1));const c=document.getElementById("categorySelect");if(c){const s=document.getElementById("equipmentTypeSelect"),o=s?Array.from(s.options):[];o.length&&!p&&(p=o.map(u=>u.cloneNode(!0)));const i=()=>{if(!s)return;const u=c.value;s.innerHTML="";const g=o[0];if(g&&s.appendChild(g.cloneNode(!0)),o.slice(1).forEach(t=>{const h=t.getAttribute("data-category-id");(!u||u===""||h===u)&&s.appendChild(t.cloneNode(!0))}),s.value="",u){s.disabled=!1;const t=document.getElementById("equipmentTypeHelp");t&&(t.style.display="none")}else{s.disabled=!0;const t=document.getElementById("equipmentTypeHelp");t&&(t.classList.remove("hidden"),t.style.display="",t.style.opacity="1")}};i(),c.addEventListener("change",()=>{i(),m(1)})}const y=document.getElementById("equipmentTypeSelect");y&&y.addEventListener("change",()=>m(1));const a=document.getElementById("availabilitySelect");a&&a.addEventListener("change",()=>m(1));const d=document.getElementById("clearFiltersButton");d&&d.addEventListener("click",I)});window.loadPage=function(l){m(l)};
